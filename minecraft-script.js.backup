// Minecraft-style biome blocks with their mood associations
const minecraftBlocks = {
    plains: {
        name: 'å¹³åŸãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'è‰ãƒ–ãƒ­ãƒƒã‚¯', texture: 'ğŸŸ¢', durability: 1, rarity: 'common', craftable: ['ã‚µãƒã‚¤ãƒãƒ«ã‚·ã‚§ãƒ«ã‚¿ãƒ¼'] },
            { name: 'åœŸãƒ–ãƒ­ãƒƒã‚¯', texture: 'ğŸŸ¤', durability: 1, rarity: 'common', craftable: ['åŸºæœ¬å»ºæ'] },
            { name: 'çŸ³ãƒ–ãƒ­ãƒƒã‚¯', texture: 'â¬œ', durability: 3, rarity: 'common', craftable: ['çŸ³ã®é“å…·'] },
            { name: 'æœ¨æ', texture: 'ğŸŸ«', durability: 2, rarity: 'common', craftable: ['æœ¨ã®é“å…·', 'ä½œæ¥­å°'] }
        ],
        mood: 'peaceful',
        color: '#7CB342'
    },
    forest: {
        name: 'æ£®æ—ãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'ã‚ªãƒ¼ã‚¯ã®åŸæœ¨', texture: 'ğŸŒ³', durability: 3, rarity: 'common', craftable: ['é«˜ç´šå»ºæ'] },
            { name: 'ã‚·ãƒ©ã‚«ãƒã®åŸæœ¨', texture: 'ğŸŒ²', durability: 3, rarity: 'uncommon', craftable: ['è£…é£¾æ'] },
            { name: 'è‹—æœ¨', texture: 'ğŸŒ±', durability: 1, rarity: 'uncommon', craftable: ['æ£®ã®å†ç”Ÿ'] },
            { name: 'ã‚­ãƒã‚³', texture: 'ğŸ„', durability: 1, rarity: 'rare', craftable: ['é­”æ³•ã®ãƒãƒ¼ã‚·ãƒ§ãƒ³'] }
        ],
        mood: 'creative',
        color: '#4CAF50'
    },
    mountain: {
        name: 'å±±å²³ãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'çŸ³ç‚­é‰±çŸ³', texture: 'âš«', durability: 4, rarity: 'uncommon', craftable: ['ç‡ƒæ–™'] },
            { name: 'é‰„é‰±çŸ³', texture: 'ğŸ”¸', durability: 5, rarity: 'uncommon', craftable: ['é‰„ã®é“å…·'] },
            { name: 'é‡‘é‰±çŸ³', texture: 'ğŸŸ¡', durability: 6, rarity: 'rare', craftable: ['é‡‘ã®é“å…·'] },
            { name: 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰é‰±çŸ³', texture: 'ğŸ’', durability: 10, rarity: 'legendary', craftable: ['æœ€å¼·è£…å‚™'] }
        ],
        mood: 'focused',
        color: '#795548'
    },
    ocean: {
        name: 'æµ·æ´‹ãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'æµ·è‰', texture: 'ğŸŒ¿', durability: 1, rarity: 'common', craftable: ['æ°´ä¸­å‘¼å¸è–¬'] },
            { name: 'çŠç‘š', texture: 'ğŸª¸', durability: 2, rarity: 'uncommon', craftable: ['è£…é£¾å“'] },
            { name: 'ãƒ—ãƒªã‚ºãƒãƒªãƒ³', texture: 'ğŸ’ ', durability: 5, rarity: 'rare', craftable: ['æµ·åº•ç¥æ®¿'] },
            { name: 'æµ·ã®å¿ƒ', texture: 'ğŸ’™', durability: 15, rarity: 'legendary', craftable: ['æµ·ç¥ã®åŠ›'] }
        ],
        mood: 'relaxed',
        color: '#03A9F4'
    },
    desert: {
        name: 'ç ‚æ¼ ãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'ç ‚ãƒ–ãƒ­ãƒƒã‚¯', texture: 'ğŸŸ¨', durability: 1, rarity: 'common', craftable: ['ã‚¬ãƒ©ã‚¹'] },
            { name: 'ã‚µãƒœãƒ†ãƒ³', texture: 'ğŸŒµ', durability: 2, rarity: 'uncommon', craftable: ['æŸ“æ–™'] },
            { name: 'ç ‚å²©', texture: 'ğŸŸ§', durability: 3, rarity: 'uncommon', craftable: ['å»ºç¯‰æ'] },
            { name: 'ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰', texture: 'ğŸ’š', durability: 8, rarity: 'rare', craftable: ['äº¤æ˜“ã‚¢ã‚¤ãƒ†ãƒ '] }
        ],
        mood: 'energetic',
        color: '#FFC107'
    },
    nether: {
        name: 'ãƒã‚¶ãƒ¼ãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'ãƒã‚¶ãƒ¼ãƒ©ãƒƒã‚¯', texture: 'ğŸ”´', durability: 1, rarity: 'uncommon', craftable: ['æ°¸ç¶šç‡ƒç„¼'] },
            { name: 'ã‚°ãƒ­ã‚¦ã‚¹ãƒˆãƒ¼ãƒ³', texture: 'ğŸŸ¡', durability: 3, rarity: 'rare', craftable: ['æ˜ã‚‹ã„ç…§æ˜'] },
            { name: 'ãƒã‚¶ãƒ¼ã‚¯ã‚©ãƒ¼ãƒ„', texture: 'âšª', durability: 5, rarity: 'rare', craftable: ['ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³å›è·¯'] },
            { name: 'ãƒã‚¶ãƒ©ã‚¤ãƒˆ', texture: 'ğŸ–¤', durability: 20, rarity: 'legendary', craftable: ['æœ€çµ‚è£…å‚™'] }
        ],
        mood: 'intense',
        color: '#D32F2F'
    },
    end: {
        name: 'ã‚¨ãƒ³ãƒ‰ãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'ã‚¨ãƒ³ãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³', texture: 'ğŸŸ¢', durability: 4, rarity: 'rare', craftable: ['ã‚¨ãƒ³ãƒ‰å»ºç¯‰'] },
            { name: 'ã‚³ãƒ¼ãƒ©ã‚¹ãƒ•ãƒ«ãƒ¼ãƒ„', texture: 'ğŸŸ£', durability: 2, rarity: 'rare', craftable: ['ãƒ†ãƒ¬ãƒãƒ¼ãƒˆè–¬'] },
            { name: 'ã‚¨ãƒ³ãƒ‰ãƒ­ãƒƒãƒ‰', texture: 'â­', durability: 6, rarity: 'rare', craftable: ['ã‚¨ãƒ³ãƒ‰ç…§æ˜'] },
            { name: 'ãƒ‰ãƒ©ã‚´ãƒ³ã‚¨ãƒƒã‚°', texture: 'ğŸ¥š', durability: 50, rarity: 'ultimate', craftable: ['ãƒ‰ãƒ©ã‚´ãƒ³å¬å–š'] }
        ],
        mood: 'transcendent',
        color: '#9C27B0'
    },
    village: {
        name: 'æ‘ãƒã‚¤ã‚ªãƒ¼ãƒ ',
        blocks: [
            { name: 'è¾²ä½œç‰©', texture: 'ğŸŒ¾', durability: 1, rarity: 'common', craftable: ['é£Ÿæ–™'] },
            { name: 'ãƒ‘ãƒ³', texture: 'ğŸ', durability: 1, rarity: 'common', craftable: ['å›å¾©ã‚¢ã‚¤ãƒ†ãƒ '] },
            { name: 'å–å¼•å°', texture: 'ğŸ“¦', durability: 5, rarity: 'uncommon', craftable: ['æ‘äººå–å¼•'] },
            { name: 'ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆæœ¬', texture: 'ğŸ“š', durability: 10, rarity: 'legendary', craftable: ['æœ€å¼·ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆ'] }
        ],
        mood: 'social',
        color: '#8BC34A'
    }
};

class MinecraftVibeCrafting {
    constructor() {
        this.currentBiome = null;
        this.currentIntensity = 5;
        this.miningRecords = [];
        this.activeMining = new Map();
        
        // Minecraft-style game system properties
        this.biomeProgress = {};
        this.playerStats = {
            totalBlocks: 0,
            miningStreak: 0,
            lastMiningDate: null,
            achievements: [],
            totalExperience: 0,
            playerLevel: 1,
            health: 20,
            hunger: 20,
            inventory: {},
            tools: {
                pickaxe: { level: 'wood', durability: 59, efficiency: 1 },
                shovel: { level: 'wood', durability: 59, efficiency: 1 },
                axe: { level: 'wood', durability: 59, efficiency: 1 }
            }
        };

        // Advanced Minecraft creature system
        this.minecraftCreature = {
            name: 'ã‚¹ãƒ†ã‚£ãƒ¼ãƒ–',
            level: 1,
            experience: 0,
            health: 20,
            hunger: 20,
            dimension: 'overworld',
            gameMode: 'survival',
            
            stats: {
                miningSpeed: 1.0,
                damage: 2.0,
                defense: 0,
                luck: 0,
                efficiency: 1.0
            },
            
            equipment: {
                helmet: null,
                chestplate: null,
                leggings: null,
                boots: null,
                mainHand: { type: 'wooden_pickaxe', durability: 59 },
                offHand: null
            },
            
            achievements: {
                gettingWood: false,
                benchmarking: false,
                timeToMine: false,
                hotStuff: false,
                acquireHardware: false,
                diamonds: false,
                enterTheNether: false,
                theEnd: false
            },
            
            worldData: {
                spawnPoint: { x: 0, y: 64, z: 0 },
                currentPosition: { x: 0, y: 64, z: 0 },
                exploredBiomes: ['plains'],
                structuresFound: [],
                mobsEncountered: [],
                timePlayed: 0
            },
            
            buildingProjects: [],
            redstoneKnowledge: 0,
            farmingLevel: 0,
            combatLevel: 0
        };

        // Crafting recipes system
        this.craftingRecipes = {
            'wooden_pickaxe': {
                materials: { 'æœ¨æ': 3, 'æ£’': 2 },
                result: { type: 'tool', name: 'wooden_pickaxe', durability: 59 },
                category: 'tools'
            },
            'stone_pickaxe': {
                materials: { 'çŸ³ãƒ–ãƒ­ãƒƒã‚¯': 3, 'æ£’': 2 },
                result: { type: 'tool', name: 'stone_pickaxe', durability: 131 },
                category: 'tools'
            },
            'iron_pickaxe': {
                materials: { 'é‰„é‰±çŸ³': 3, 'æ£’': 2 },
                result: { type: 'tool', name: 'iron_pickaxe', durability: 250 },
                category: 'tools'
            },
            'diamond_pickaxe': {
                materials: { 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰é‰±çŸ³': 3, 'æ£’': 2 },
                result: { type: 'tool', name: 'diamond_pickaxe', durability: 1561 },
                category: 'tools'
            }
        };

        // Advanced minigame system
        this.minecraftGames = {
            mining: { name: 'ãƒã‚¤ãƒ‹ãƒ³ã‚°ãƒãƒ£ãƒ¬ãƒ³ã‚¸', difficulty: 2, rewards: ['é‰±çŸ³', 'çµŒé¨“å€¤'] },
            building: { name: 'ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ', difficulty: 4, rewards: ['å»ºç¯‰ã‚¹ã‚­ãƒ«', 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒ³ãƒˆ'] },
            survival: { name: 'ã‚µãƒã‚¤ãƒãƒ«ãƒãƒ£ãƒ¬ãƒ³ã‚¸', difficulty: 6, rewards: ['ã‚µãƒã‚¤ãƒãƒ«ã‚¹ã‚­ãƒ«', 'å¸Œå°‘ã‚¢ã‚¤ãƒ†ãƒ '] },
            redstone: { name: 'ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³ãƒ‘ã‚ºãƒ«', difficulty: 8, rewards: ['ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³çŸ¥è­˜', 'å›è·¯è¨­è¨ˆå›³'] },
            pvp: { name: 'PvPã‚¢ãƒªãƒ¼ãƒŠ', difficulty: 10, rewards: ['æˆ¦é—˜ã‚¹ã‚­ãƒ«', 'ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ã‚¿ã‚¤ãƒˆãƒ«'] }
        };

        // Theme-related properties
        this.themeSelector = document.getElementById('themeSelector');
        this.darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        this.init();
    }

    init() {
        this.bindEvents();
        this.loadMinecraftData();
        const preferredTheme = this.loadThemePreference();
        this.applyTheme(preferredTheme);
    }

    // Data Management Methods
    loadMinecraftData() {
        const savedRecords = localStorage.getItem('miningRecords');
        const savedBiomeProgress = localStorage.getItem('biomeProgress');
        const savedPlayerStats = localStorage.getItem('playerStats');
        const savedCreature = localStorage.getItem('minecraftCreature');
        
        if (savedRecords) {
            this.miningRecords = JSON.parse(savedRecords);
        }
        
        if (savedBiomeProgress) {
            this.biomeProgress = JSON.parse(savedBiomeProgress);
        }
        
        if (savedPlayerStats) {
            this.playerStats = { ...this.playerStats, ...JSON.parse(savedPlayerStats) };
        }
        
        if (savedCreature) {
            this.minecraftCreature = { ...this.minecraftCreature, ...JSON.parse(savedCreature) };
        }
        
        this.initializeBiomeProgress();
    }

    saveMinecraftData() {
        localStorage.setItem('miningRecords', JSON.stringify(this.miningRecords));
        localStorage.setItem('biomeProgress', JSON.stringify(this.biomeProgress));
        localStorage.setItem('playerStats', JSON.stringify(this.playerStats));
        localStorage.setItem('minecraftCreature', JSON.stringify(this.minecraftCreature));
    }

    initializeBiomeProgress() {
        Object.keys(minecraftBlocks).forEach(biome => {
            if (!this.biomeProgress[biome]) {
                this.biomeProgress[biome] = {
                    level: 1,
                    experience: 0,
                    blocksFound: 0,
                    unlocked: biome === 'plains'
                };
            }
        });
    }

    // Core Minecraft gameplay methods
    handleBiomeSelection(biome) {
        this.currentBiome = biome;
        this.updateActiveBiome(biome);
        this.displayBlockPalette(biome);
        this.showMinecraftOptions();
    }

    updateActiveBiome(selectedBiome) {
        const biomeButtons = document.querySelectorAll('.biome-btn');
        biomeButtons.forEach(button => {
            button.classList.remove('active');
            if (button.dataset.biome === selectedBiome) {
                button.classList.add('active');
            }
        });
    }

    displayBlockPalette(biome) {
        const biomeData = minecraftBlocks[biome];
        const paletteSection = document.getElementById('blockPalette');
        const paletteTitle = document.getElementById('paletteTitle');
        const blockGrid = document.getElementById('blockGrid');

        paletteTitle.textContent = `${biomeData.name}ã®ãƒ–ãƒ­ãƒƒã‚¯`;
        
        blockGrid.innerHTML = '';
        
        biomeData.blocks.forEach(block => {
            const blockCard = this.createBlockCard(block);
            blockGrid.appendChild(blockCard);
        });

        paletteSection.classList.add('show');
    }

    createBlockCard(block) {
        const card = document.createElement('div');
        card.className = `block-card rarity-${block.rarity}`;
        card.addEventListener('click', () => this.collectBlock(block));

        const rarityClass = this.getRarityClass(block.rarity);
        
        card.innerHTML = `
            <div class="block-texture">${block.texture}</div>
            <div class="block-info">
                <div class="block-name">${block.name}</div>
                <div class="block-rarity ${rarityClass}">${this.getRarityName(block.rarity)}</div>
                <div class="block-durability">è€ä¹…åº¦: ${block.durability}</div>
            </div>
        `;

        return card;
    }

    getRarityClass(rarity) {
        const rarityClasses = {
            'common': 'rarity-common',
            'uncommon': 'rarity-uncommon',
            'rare': 'rarity-rare',
            'legendary': 'rarity-legendary',
            'ultimate': 'rarity-ultimate'
        };
        return rarityClasses[rarity] || 'rarity-common';
    }

    getRarityName(rarity) {
        const rarityNames = {
            'common': 'ã‚³ãƒ¢ãƒ³',
            'uncommon': 'ã‚¢ãƒ³ã‚³ãƒ¢ãƒ³',
            'rare': 'ãƒ¬ã‚¢',
            'legendary': 'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼',
            'ultimate': 'ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ'
        };
        return rarityNames[rarity] || 'ã‚³ãƒ¢ãƒ³';
    }

    collectBlock(block) {
        // Add to inventory
        const blockName = block.name;
        if (!this.playerStats.inventory[blockName]) {
            this.playerStats.inventory[blockName] = 0;
        }
        this.playerStats.inventory[blockName]++;
        
        // Add experience
        const expGain = this.calculateExpGain(block);
        this.playerStats.totalExperience += expGain;
        
        // Update stats
        this.playerStats.totalBlocks++;
        this.updateBiomeProgress(this.currentBiome, expGain);
        
        // Show collection notification
        this.showCollectionNotification(block, expGain);
        
        // Check achievements
        this.checkMinecraftAchievements();
        
        // Save data
        this.saveMinecraftData();
    }

    calculateExpGain(block) {
        const rarityMultiplier = {
            'common': 1,
            'uncommon': 2,
            'rare': 5,
            'legendary': 15,
            'ultimate': 50
        };
        
        const baseExp = 10;
        const multiplier = rarityMultiplier[block.rarity] || 1;
        const intensityBonus = Math.floor(this.currentIntensity * 2);
        
        return baseExp * multiplier + intensityBonus;
    }

    updateBiomeProgress(biome, expGain) {
        if (this.biomeProgress[biome]) {
            this.biomeProgress[biome].experience += expGain;
            this.biomeProgress[biome].blocksFound++;
            this.checkBiomeLevelUp(biome);
        }
    }

    checkBiomeLevelUp(biome) {
        const biomeData = this.biomeProgress[biome];
        const requiredExp = this.getRequiredExperience(biomeData.level);
        
        if (biomeData.experience >= requiredExp) {
            biomeData.level++;
            biomeData.experience -= requiredExp;
            this.showBiomeLevelUpNotification(biome, biomeData.level);
            this.unlockNewBiomes(biome, biomeData.level);
        }
    }

    getRequiredExperience(level) {
        return Math.floor(100 * Math.pow(1.5, level - 1));
    }

    showBiomeLevelUpNotification(biome, newLevel) {
        const biomeName = minecraftBlocks[biome]?.name || biome;
        const notification = document.getElementById('notification');
        notification.textContent = `ğŸ‰ ${biomeName} ãŒãƒ¬ãƒ™ãƒ« ${newLevel} ã«ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸï¼`;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    unlockNewBiomes(currentBiome, level) {
        const unlockMap = {
            'plains': { level: 3, unlocks: ['forest', 'desert'] },
            'forest': { level: 5, unlocks: ['mountain'] },
            'mountain': { level: 7, unlocks: ['ocean'] },
            'desert': { level: 5, unlocks: ['nether'] },
            'nether': { level: 10, unlocks: ['end'] },
            'ocean': { level: 8, unlocks: ['village'] }
        };

        const unlockData = unlockMap[currentBiome];
        if (unlockData && level >= unlockData.level) {
            unlockData.unlocks.forEach(biome => {
                if (!this.biomeProgress[biome].unlocked) {
                    this.biomeProgress[biome].unlocked = true;
                    this.showBiomeUnlockNotification(biome);
                }
            });
        }
    }

    showBiomeUnlockNotification(biome) {
        const biomeName = minecraftBlocks[biome]?.name || biome;
        const notification = document.getElementById('notification');
        notification.textContent = `ğŸ—ºï¸ æ–°ã—ã„ãƒã‚¤ã‚ªãƒ¼ãƒ è§£æ”¾: ${biomeName}`;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    showCollectionNotification(block, expGain) {
        const notification = document.getElementById('notification');
        notification.textContent = `${block.texture} ${block.name} ã‚’å…¥æ‰‹ï¼ (+${expGain} EXP)`;
        notification.classList.add('show');
        
        // Create particle effect
        this.createBlockParticleEffect(block);
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 2000);
    }

    createBlockParticleEffect(block) {
        const character = document.getElementById('minecraftCharacter');
        if (!character) return;
        
        const rect = character.getBoundingClientRect();
        
        for (let i = 0; i < 5; i++) {
            const particle = document.createElement('div');
            particle.className = 'block-particle';
            particle.textContent = block.texture;
            particle.style.left = (rect.left + rect.width/2) + 'px';
            particle.style.top = (rect.top + rect.height/2) + 'px';
            particle.style.animationDelay = (i * 0.1) + 's';
            
            document.body.appendChild(particle);
            
            setTimeout(() => {
                particle.remove();
            }, 1000);
        }
    }

    // Enhanced Minecraft minigames
    startMinecraftGame(gameType) {
        this.currentGame = gameType;
        this.gameScore = 0;
        
        const gameArea = document.getElementById('minecraftGameArea');
        const gameContent = document.getElementById('gameContent');
        const gameControls = document.getElementById('gameControls');
        
        gameArea.style.display = 'block';
        
        switch(gameType) {
            case 'mining':
                this.startMiningGame(gameContent, gameControls);
                break;
            case 'building':
                this.startBuildingGame(gameContent, gameControls);
                break;
            case 'survival':
                this.startSurvivalGame(gameContent, gameControls);
                break;
            case 'redstone':
                this.startRedstoneGame(gameContent, gameControls);
                break;
            case 'pvp':
                this.startPvPGame(gameContent, gameControls);
                break;
        }
    }

    startMiningGame(content, controls) {
        content.innerHTML = `
            <h3>â›ï¸ ãƒã‚¤ãƒ‹ãƒ³ã‚°ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <p>æ­£ç¢ºãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ–ãƒ­ãƒƒã‚¯ã‚’æ˜ã‚ã†ï¼</p>
            <div class="mining-area">
                <div class="ore-vein" id="oreVein">
                    <div class="mining-cursor" id="miningCursor"></div>
                    <div class="ore-target" id="oreTarget">ğŸ’</div>
                </div>
                <div class="tool-durability">
                    <div class="durability-bar" id="durabilityBar"></div>
                    <span>ãƒ„ãƒ¼ãƒ«è€ä¹…åº¦</span>
                </div>
            </div>
        `;
        
        controls.innerHTML = `
            <button class="game-action-btn" id="mineBtn">â›ï¸ æ˜ã‚‹</button>
            <div class="game-score">ã‚¹ã‚³ã‚¢: <span id="gameScore">0</span></div>
            <div class="blocks-mined">ãƒ–ãƒ­ãƒƒã‚¯: <span id="blocksMined">0</span></div>
        `;

        let cursorPosition = 0;
        let direction = 1;
        let targetPosition = Math.random() * 80 + 10;
        let toolDurability = 100;
        let blocksMined = 0;
        
        const gameInterval = setInterval(() => {
            cursorPosition += direction * 3;
            if (cursorPosition >= 100) {
                cursorPosition = 100;
                direction = -1;
            } else if (cursorPosition <= 0) {
                cursorPosition = 0;
                direction = 1;
            }
            
            document.getElementById('miningCursor').style.left = cursorPosition + '%';
        }, 50);

        document.getElementById('mineBtn').addEventListener('click', () => {
            const accuracy = 100 - Math.abs(cursorPosition - targetPosition);
            toolDurability -= 5;
            
            if (accuracy > 70) {
                const points = Math.floor(accuracy * 2);
                this.gameScore += points;
                blocksMined++;
                
                // Create new target
                targetPosition = Math.random() * 80 + 10;
                document.getElementById('oreTarget').style.left = targetPosition + '%';
                
                this.showMiningEffect('Perfect! â›ï¸âœ¨');
            } else if (accuracy > 40) {
                this.gameScore += 10;
                this.showMiningEffect('Good! ğŸª¨');
            } else {
                this.showMiningEffect('Miss! ğŸ’¥');
            }
            
            document.getElementById('gameScore').textContent = this.gameScore;
            document.getElementById('blocksMined').textContent = blocksMined;
            document.getElementById('durabilityBar').style.width = toolDurability + '%';
            
            if (toolDurability <= 0) {
                clearInterval(gameInterval);
                this.endMinecraftGame('ãƒ„ãƒ¼ãƒ«ãŒå£Šã‚Œã¾ã—ãŸï¼');
            }
        });

        setTimeout(() => {
            clearInterval(gameInterval);
            this.endMinecraftGame('æ™‚é–“çµ‚äº†ï¼');
        }, 30000);
    }

    startBuildingGame(content, controls) {
        content.innerHTML = `
            <h3>ğŸ—ï¸ ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <p>ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã£ã¦æ­£ç¢ºã«å»ºç¯‰ã—ã‚ˆã†ï¼</p>
            <div class="building-area">
                <div class="blueprint" id="blueprint"></div>
                <div class="construction-grid" id="constructionGrid"></div>
            </div>
        `;
        
        controls.innerHTML = `
            <div class="block-selector" id="blockSelector">
                <div class="block-option" data-block="ğŸŸ«">ğŸŸ«</div>
                <div class="block-option" data-block="ğŸŸ¢">ğŸŸ¢</div>
                <div class="block-option" data-block="ğŸ”´">ğŸ”´</div>
                <div class="block-option" data-block="ğŸŸ¦">ğŸŸ¦</div>
            </div>
            <div class="game-score">å®Œæˆåº¦: <span id="gameScore">0</span>%</div>
        `;

        const gridSize = 5;
        const pattern = this.generateBuildingPattern(gridSize);
        const playerConstruction = Array(gridSize).fill().map(() => Array(gridSize).fill('â¬œ'));
        
        this.renderBuildingBlueprint(pattern);
        this.renderConstructionGrid(playerConstruction, gridSize);
        
        let selectedBlock = 'ğŸŸ«';
        
        document.querySelectorAll('.block-option').forEach(option => {
            option.addEventListener('click', (e) => {
                selectedBlock = e.target.dataset.block;
                document.querySelectorAll('.block-option').forEach(opt => opt.classList.remove('selected'));
                e.target.classList.add('selected');
            });
        });
        
        document.querySelectorAll('.construction-cell').forEach((cell, index) => {
            cell.addEventListener('click', () => {
                const row = Math.floor(index / gridSize);
                const col = index % gridSize;
                playerConstruction[row][col] = selectedBlock;
                cell.textContent = selectedBlock;
                
                const accuracy = this.calculateBuildingAccuracy(pattern, playerConstruction);
                document.getElementById('gameScore').textContent = Math.floor(accuracy);
                
                if (accuracy >= 100) {
                    this.endMinecraftGame('å®Œç’§ãªå»ºç¯‰ï¼ğŸ†');
                }
            });
        });
    }

    generateBuildingPattern(size) {
        const blocks = ['ğŸŸ«', 'ğŸŸ¢', 'ğŸ”´', 'ğŸŸ¦'];
        return Array(size).fill().map(() => 
            Array(size).fill().map(() => blocks[Math.floor(Math.random() * blocks.length)])
        );
    }

    renderBuildingBlueprint(pattern) {
        const blueprint = document.getElementById('blueprint');
        blueprint.innerHTML = '';
        
        pattern.forEach(row => {
            row.forEach(block => {
                const cell = document.createElement('div');
                cell.className = 'blueprint-cell';
                cell.textContent = block;
                blueprint.appendChild(cell);
            });
        });
    }

    renderConstructionGrid(construction, size) {
        const grid = document.getElementById('constructionGrid');
        grid.innerHTML = '';
        
        construction.forEach((row, rowIndex) => {
            row.forEach((block, colIndex) => {
                const cell = document.createElement('div');
                cell.className = 'construction-cell';
                cell.textContent = block;
                grid.appendChild(cell);
            });
        });
    }

    calculateBuildingAccuracy(pattern, construction) {
        let matches = 0;
        let total = 0;
        
        for (let i = 0; i < pattern.length; i++) {
            for (let j = 0; j < pattern[i].length; j++) {
                total++;
                if (pattern[i][j] === construction[i][j]) {
                    matches++;
                }
            }
        }
        
        return (matches / total) * 100;
    }

    showMiningEffect(message) {
        const effect = document.createElement('div');
        effect.className = 'mining-effect';
        effect.textContent = message;
        document.getElementById('gameContent').appendChild(effect);
        
        setTimeout(() => {
            effect.remove();
        }, 1000);
    }

    endMinecraftGame(message) {
        const reward = Math.floor(this.gameScore / 10);
        this.playerStats.totalExperience += reward;
        this.minecraftCreature.experience += reward;
        
        // Add blocks to inventory based on game type
        if (this.currentGame === 'mining') {
            const blocksGained = Math.floor(this.gameScore / 50);
            if (!this.playerStats.inventory['stone']) this.playerStats.inventory['stone'] = 0;
            this.playerStats.inventory['stone'] += blocksGained;
        }
        
        this.updateCreatureMessage(`ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼${reward}çµŒé¨“å€¤ã‚’ã‚²ãƒƒãƒˆã—ã¾ã—ãŸï¼`);
        this.checkPlayerLevelUp();
        this.saveMinecraftData();
        
        setTimeout(() => {
            this.exitMinecraftGame();
        }, 2000);
    }

    exitMinecraftGame() {
        document.getElementById('minecraftGameArea').style.display = 'none';
        this.currentGame = null;
        this.gameScore = 0;
    }

    checkMinecraftAchievements() {
        const achievements = [
            {
                id: 'getting_wood',
                name: 'æœ¨ã‚’æ‰‹ã«å…¥ã‚Œã‚‹',
                description: 'åˆã‚ã¦æœ¨æã‚’å…¥æ‰‹ã—ã¾ã—ãŸ',
                condition: () => this.playerStats.inventory['æœ¨æ'] >= 1
            },
            {
                id: 'stone_age',
                name: 'çŸ³å™¨æ™‚ä»£',
                description: 'çŸ³ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ',
                condition: () => this.playerStats.inventory['çŸ³ãƒ–ãƒ­ãƒƒã‚¯'] >= 10
            },
            {
                id: 'iron_age',
                name: 'é‰„å™¨æ™‚ä»£',
                description: 'é‰„ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ',
                condition: () => this.playerStats.inventory['é‰„é‰±çŸ³'] >= 5
            },
            {
                id: 'diamonds',
                name: 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ï¼',
                description: 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã‚’ç™ºè¦‹ã—ã¾ã—ãŸ',
                condition: () => this.playerStats.inventory['ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰é‰±çŸ³'] >= 1
            },
            {
                id: 'master_miner',
                name: 'ãƒã‚¹ã‚¿ãƒ¼ãƒã‚¤ãƒŠãƒ¼',
                description: '1000å€‹ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’æ¡æ˜ã—ã¾ã—ãŸ',
                condition: () => this.playerStats.totalBlocks >= 1000
            }
        ];

        achievements.forEach(achievement => {
            if (!this.playerStats.achievements.includes(achievement.id) && achievement.condition()) {
                this.playerStats.achievements.push(achievement.id);
                this.showAchievementNotification(achievement);
            }
        });
    }

    showAchievementNotification(achievement) {
        const notification = document.getElementById('notification');
        notification.textContent = `ğŸ… å®Ÿç¸¾è§£é™¤: ${achievement.name}`;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 4000);
    }

    updateCreatureMessage(message) {
        const messageElement = document.getElementById('creatureMessage');
        if (messageElement) {
            messageElement.textContent = message;
        }
    }

    checkPlayerLevelUp() {
        const requiredExp = this.getRequiredExperience(this.playerStats.playerLevel);
        
        if (this.playerStats.totalExperience >= requiredExp) {
            this.playerStats.playerLevel++;
            this.showPlayerLevelUpNotification();
        }
    }

    showPlayerLevelUpNotification() {
        const notification = document.getElementById('notification');
        notification.textContent = `ğŸ‰ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.${this.playerStats.playerLevel}`;
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Theme management
    applyTheme(theme) {
        let activeTheme = theme;
        if (theme === 'system') {
            activeTheme = this.darkModeMediaQuery.matches ? 'dark' : 'light';
        }
        document.documentElement.dataset.theme = activeTheme;
        if (this.themeSelector) {
            this.themeSelector.value = theme;
        }
    }

    saveThemePreference(theme) {
        localStorage.setItem('themePreference', theme);
    }

    loadThemePreference() {
        return localStorage.getItem('themePreference') || 'system';
    }

    showMinecraftOptions() {
        const intensitySection = document.getElementById('intensitySection');
        const gameSection = document.getElementById('gameSection');
        const inventorySection = document.getElementById('inventorySection');
        
        [intensitySection, gameSection, inventorySection].forEach(section => {
            if (section) {
                section.style.display = 'block';
            }
        });
    }

    // Event binding
    bindEvents() {
        // Original biome events
        const biomeButtons = document.querySelectorAll('.biome-btn');
        biomeButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const biome = e.target.dataset.biome;
                if (this.biomeProgress[biome]?.unlocked) {
                    this.handleBiomeSelection(biome);
                } else {
                    this.showLockedBiomeMessage(biome);
                }
            });
        });

        // Theme events
        if (this.themeSelector) {
            this.themeSelector.addEventListener('change', (e) => {
                const selectedTheme = e.target.value;
                this.saveThemePreference(selectedTheme);
                this.applyTheme(selectedTheme);
            });
        }

        // Game events
        const gameButtons = [
            { id: 'startMiningGame', game: 'mining' },
            { id: 'startBuildingGame', game: 'building' },
            { id: 'startSurvivalGame', game: 'survival' },
            { id: 'startRedstoneGame', game: 'redstone' },
            { id: 'startPvPGame', game: 'pvp' }
        ];
        
        gameButtons.forEach(({ id, game }) => {
            const button = document.getElementById(id);
            if (button) {
                button.addEventListener('click', () => this.startMinecraftGame(game));
            }
        });
        
        const exitGameBtn = document.getElementById('exitGame');
        if (exitGameBtn) {
            exitGameBtn.addEventListener('click', () => this.exitMinecraftGame());
        }

        // Bind additional Minecraft-specific events
        this.bindMinecraftEvents();

        // Initialize displays
        this.renderPlayerStats();
        this.renderCreatureDisplay();
        this.updateBiomeButtons();
    }

    recordCurrentMining() {
        if (!this.currentBiome) {
            this.showNotification('å…ˆã«ãƒã‚¤ã‚ªãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„');
            return;
        }

        // Simulate a mining session
        const biomeData = minecraftBlocks[this.currentBiome];
        const randomBlock = biomeData.blocks[Math.floor(Math.random() * biomeData.blocks.length)];
        
        this.collectBlock(randomBlock);
        this.showNotification(`${randomBlock.texture} ${randomBlock.name} ã‚’æ¡æ˜ã—ã¾ã—ãŸï¼`);
    }

    showNotification(message) {
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    }

    renderInventory() {
        const inventoryGrid = document.getElementById('inventoryGrid');
        if (!inventoryGrid) return;
        
        inventoryGrid.innerHTML = '';
        
        Object.entries(this.playerStats.inventory).forEach(([itemName, count]) => {
            const itemCard = document.createElement('div');
            itemCard.className = 'inventory-item';
            itemCard.innerHTML = `
                <div class="item-icon">${this.getItemIcon(itemName)}</div>
                <div class="item-name">${itemName}</div>
                <div class="item-count">${count}</div>
            `;
            inventoryGrid.appendChild(itemCard);
        });
    }

    getItemIcon(itemName) {
        const iconMap = {
            'è‰ãƒ–ãƒ­ãƒƒã‚¯': 'ğŸŸ¢',
            'åœŸãƒ–ãƒ­ãƒƒã‚¯': 'ğŸŸ¤',
            'çŸ³ãƒ–ãƒ­ãƒƒã‚¯': 'â¬œ',
            'æœ¨æ': 'ğŸŸ«',
            'ã‚ªãƒ¼ã‚¯ã®åŸæœ¨': 'ğŸŒ³',
            'ã‚·ãƒ©ã‚«ãƒã®åŸæœ¨': 'ğŸŒ²',
            'è‹—æœ¨': 'ğŸŒ±',
            'ã‚­ãƒã‚³': 'ğŸ„',
            'çŸ³ç‚­é‰±çŸ³': 'âš«',
            'é‰„é‰±çŸ³': 'ğŸ”¸',
            'é‡‘é‰±çŸ³': 'ğŸŸ¡',
            'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰é‰±çŸ³': 'ğŸ’',
            'æµ·è‰': 'ğŸŒ¿',
            'çŠç‘š': 'ğŸª¸',
            'ãƒ—ãƒªã‚ºãƒãƒªãƒ³': 'ğŸ’ ',
            'æµ·ã®å¿ƒ': 'ğŸ’™',
            'ç ‚ãƒ–ãƒ­ãƒƒã‚¯': 'ğŸŸ¨',
            'ã‚µãƒœãƒ†ãƒ³': 'ğŸŒµ',
            'ç ‚å²©': 'ğŸŸ§',
            'ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰': 'ğŸ’š',
            'ãƒã‚¶ãƒ¼ãƒ©ãƒƒã‚¯': 'ğŸ”´',
            'ã‚°ãƒ­ã‚¦ã‚¹ãƒˆãƒ¼ãƒ³': 'ğŸŸ¡',
            'ãƒã‚¶ãƒ¼ã‚¯ã‚©ãƒ¼ãƒ„': 'âšª',
            'ãƒã‚¶ãƒ©ã‚¤ãƒˆ': 'ğŸ–¤',
            'ã‚¨ãƒ³ãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³': 'ğŸŸ¢',
            'ã‚³ãƒ¼ãƒ©ã‚¹ãƒ•ãƒ«ãƒ¼ãƒ„': 'ğŸŸ£',
            'ã‚¨ãƒ³ãƒ‰ãƒ­ãƒƒãƒ‰': 'â­',
            'ãƒ‰ãƒ©ã‚´ãƒ³ã‚¨ãƒƒã‚°': 'ğŸ¥š',
            'è¾²ä½œç‰©': 'ğŸŒ¾',
            'ãƒ‘ãƒ³': 'ğŸ',
            'å–å¼•å°': 'ğŸ“¦',
            'ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆæœ¬': 'ğŸ“š'
        };
        return iconMap[itemName] || 'ğŸ“¦';
    }

    // Enhanced survival games
    startSurvivalGame(content, controls) {
        content.innerHTML = `
            <h3>ğŸ›¡ï¸ ã‚µãƒã‚¤ãƒãƒ«ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <p>é™ã‚‰ã‚ŒãŸè³‡æºã§ç”Ÿãæ®‹ã‚Šã€å¤œã‚’ã—ã®ã”ã†ï¼</p>
            <div class="survival-area">
                <div class="day-night-cycle" id="dayNightCycle">
                    <div class="sun" id="sun">â˜€ï¸</div>
                    <div class="time-display" id="timeDisplay">æ˜¼é–“</div>
                </div>
                <div class="resource-management">
                    <div class="resource-bar">
                        <span>é£Ÿæ–™:</span>
                        <div class="bar"><div class="fill" id="foodBar" style="width: 100%"></div></div>
                    </div>
                    <div class="resource-bar">
                        <span>ä½“åŠ›:</span>
                        <div class="bar"><div class="fill" id="healthBar" style="width: 100%"></div></div>
                    </div>
                </div>
            </div>
        `;
        
        controls.innerHTML = `
            <button class="game-action-btn" id="gatherFood">ğŸ é£Ÿæ–™åé›†</button>
            <button class="game-action-btn" id="buildShelter">ğŸ  ã‚·ã‚§ãƒ«ã‚¿ãƒ¼å»ºè¨­</button>
            <button class="game-action-btn" id="craftTools">ğŸ”¨ é“å…·ä½œæˆ</button>
            <div class="game-score">ç”Ÿå­˜æ—¥æ•°: <span id="gameScore">0</span></div>
        `;

        let food = 100;
        let health = 100;
        let dayCount = 0;
        let isNight = false;
        
        const survivalInterval = setInterval(() => {
            // Simulate day/night cycle
            dayCount += 0.1;
            if (Math.floor(dayCount * 2) % 2 === 1 && !isNight) {
                isNight = true;
                document.getElementById('timeDisplay').textContent = 'å¤œ';
                document.getElementById('sun').textContent = 'ğŸŒ™';
                // Night dangers
                health -= 5;
                food -= 10;
            } else if (Math.floor(dayCount * 2) % 2 === 0 && isNight) {
                isNight = false;
                document.getElementById('timeDisplay').textContent = 'æ˜¼é–“';
                document.getElementById('sun').textContent = 'â˜€ï¸';
            }
            
            // Update bars
            food = Math.max(0, food - 1);
            if (food < 20) health -= 2;
            
            document.getElementById('foodBar').style.width = food + '%';
            document.getElementById('healthBar').style.width = health + '%';
            document.getElementById('gameScore').textContent = Math.floor(dayCount);
            
            if (health <= 0) {
                clearInterval(survivalInterval);
                this.endMinecraftGame('ä½“åŠ›ãŒå°½ãã¾ã—ãŸï¼ç”Ÿå­˜æ—¥æ•°: ' + Math.floor(dayCount));
            }
        }, 500);

        document.getElementById('gatherFood').addEventListener('click', () => {
            food = Math.min(100, food + 20);
            this.gameScore += 5;
        });

        document.getElementById('buildShelter').addEventListener('click', () => {
            if (isNight) health = Math.min(100, health + 15);
            this.gameScore += 10;
        });

        document.getElementById('craftTools').addEventListener('click', () => {
            food = Math.min(100, food + 10);
            this.gameScore += 8;
        });

        setTimeout(() => {
            clearInterval(survivalInterval);
            this.endMinecraftGame('ã‚µãƒã‚¤ãƒãƒ«å®Œäº†ï¼');
        }, 30000);
    }

    startRedstoneGame(content, controls) {
        content.innerHTML = `
            <h3>ğŸ”´ ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³ãƒ‘ã‚ºãƒ«</h3>
            <p>å›è·¯ã‚’æ­£ã—ãæ¥ç¶šã—ã¦ãƒ©ãƒ³ãƒ—ã‚’ç‚¹ç¯ã•ã›ã‚ˆã†ï¼</p>
            <div class="redstone-circuit" id="redstoneCircuit">
                <div class="circuit-grid" id="circuitGrid">
                    ${Array.from({length: 25}, (_, i) => 
                        `<div class="circuit-cell" data-index="${i}"></div>`
                    ).join('')}
                </div>
                <div class="target-lamps" id="targetLamps">
                    <div class="lamp" id="lamp1">ğŸ’¡</div>
                    <div class="lamp" id="lamp2">ğŸ’¡</div>
                    <div class="lamp" id="lamp3">ğŸ’¡</div>
                </div>
            </div>
        `;
        
        controls.innerHTML = `
            <div class="redstone-tools">
                <button class="tool-btn" data-tool="wire">ğŸ”´ ãƒ¯ã‚¤ãƒ¤ãƒ¼</button>
                <button class="tool-btn" data-tool="repeater">ğŸ”„ ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼</button>
                <button class="tool-btn" data-tool="switch">ğŸ”˜ ã‚¹ã‚¤ãƒƒãƒ</button>
            </div>
            <button class="game-action-btn" id="testCircuit">âš¡ å›è·¯ãƒ†ã‚¹ãƒˆ</button>
            <div class="game-score">æ­£è§£æ•°: <span id="gameScore">0</span></div>
        `;

        let selectedTool = 'wire';
        let circuit = Array(25).fill(null);
        
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                selectedTool = e.target.dataset.tool;
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('selected'));
                e.target.classList.add('selected');
            });
        });

        document.querySelectorAll('.circuit-cell').forEach((cell, index) => {
            cell.addEventListener('click', () => {
                circuit[index] = selectedTool;
                cell.textContent = selectedTool === 'wire' ? 'â€”' : selectedTool === 'repeater' ? 'ğŸ”„' : 'ğŸ”˜';
                cell.className = `circuit-cell ${selectedTool}`;
            });
        });

        document.getElementById('testCircuit').addEventListener('click', () => {
            // Simple circuit validation
            const hasSwitch = circuit.includes('switch');
            const hasWire = circuit.includes('wire');
            const hasRepeater = circuit.includes('repeater');
            
            if (hasSwitch && hasWire) {
                this.gameScore += 25;
                document.getElementById('gameScore').textContent = this.gameScore;
                this.showMiningEffect('å›è·¯æˆåŠŸï¼ âš¡');
                
                // Light up lamps
                document.querySelectorAll('.lamp').forEach(lamp => {
                    lamp.style.color = '#ffff00';
                    lamp.style.textShadow = '0 0 10px #ffff00';
                });
                
                setTimeout(() => {
                    this.endMinecraftGame('ãƒ¬ãƒƒãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³å›è·¯å®Œæˆï¼');
                }, 2000);
            } else {
                this.showMiningEffect('å›è·¯ä¸å®Œå…¨ ğŸ’¥');
            }
        });
    }

    startPvPGame(content, controls) {
        content.innerHTML = `
            <h3>âš”ï¸ PvPã‚¢ãƒªãƒ¼ãƒŠ</h3>
            <p>æˆ¦ç•¥çš„ã«æ”»æ’ƒã¨é˜²å¾¡ã‚’ä½¿ã„åˆ†ã‘ã¦å‹åˆ©ã—ã‚ˆã†ï¼</p>
            <div class="pvp-arena">
                <div class="player-status">
                    <div class="player player-1">
                        <div class="player-name">ã‚ãªãŸ</div>
                        <div class="health-bar">
                            <div class="health-fill" id="playerHealth" style="width: 100%"></div>
                        </div>
                        <div class="player-avatar">ğŸ‘·â€â™‚ï¸</div>
                    </div>
                    <div class="vs">VS</div>
                    <div class="player player-2">
                        <div class="player-name">å¯¾æˆ¦ç›¸æ‰‹</div>
                        <div class="health-bar">
                            <div class="health-fill" id="enemyHealth" style="width: 100%"></div>
                        </div>
                        <div class="player-avatar">ğŸ§Ÿâ€â™‚ï¸</div>
                    </div>
                </div>
                <div class="battle-log" id="battleLog">
                    <div class="log-entry">æˆ¦é—˜é–‹å§‹ï¼</div>
                </div>
            </div>
        `;
        
        controls.innerHTML = `
            <div class="combat-actions">
                <button class="combat-btn attack-btn" id="attackBtn">âš”ï¸ æ”»æ’ƒ</button>
                <button class="combat-btn defend-btn" id="defendBtn">ğŸ›¡ï¸ é˜²å¾¡</button>
                <button class="combat-btn special-btn" id="specialBtn">âœ¨ ç‰¹æ®Šæ”»æ’ƒ</button>
            </div>
            <div class="game-score">ãƒ€ãƒ¡ãƒ¼ã‚¸ä¸ãˆãŸ: <span id="gameScore">0</span></div>
        `;

        let playerHP = 100;
        let enemyHP = 100;
        let isDefending = false;
        
        const addBattleLog = (message) => {
            const log = document.getElementById('battleLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        };

        const updateHealthBars = () => {
            document.getElementById('playerHealth').style.width = playerHP + '%';
            document.getElementById('enemyHealth').style.width = enemyHP + '%';
        };

        const enemyTurn = () => {
            setTimeout(() => {
                const enemyActions = ['attack', 'defend', 'special'];
                const action = enemyActions[Math.floor(Math.random() * enemyActions.length)];
                
                if (action === 'attack') {
                    const damage = isDefending ? 5 : 15;
                    playerHP = Math.max(0, playerHP - damage);
                    addBattleLog(`æ•µã®æ”»æ’ƒï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸`);
                } else if (action === 'special') {
                    const damage = isDefending ? 8 : 25;
                    playerHP = Math.max(0, playerHP - damage);
                    addBattleLog(`æ•µã®ç‰¹æ®Šæ”»æ’ƒï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸`);
                } else {
                    addBattleLog('æ•µãŒé˜²å¾¡æ…‹å‹¢ã‚’å–ã£ãŸ');
                }
                
                isDefending = false;
                updateHealthBars();
                
                if (playerHP <= 0) {
                    this.endMinecraftGame('æ•—åŒ—... å†æŒ‘æˆ¦ã—ã‚ˆã†ï¼');
                } else if (enemyHP <= 0) {
                    this.endMinecraftGame('å‹åˆ©ï¼ PvPãƒã‚¹ã‚¿ãƒ¼ï¼');
                }
            }, 1500);
        };

        document.getElementById('attackBtn').addEventListener('click', () => {
            const damage = 20;
            enemyHP = Math.max(0, enemyHP - damage);
            this.gameScore += damage;
            addBattleLog(`ã‚ãªãŸã®æ”»æ’ƒï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸`);
            document.getElementById('gameScore').textContent = this.gameScore;
            updateHealthBars();
            
            if (enemyHP > 0) enemyTurn();
        });

        document.getElementById('defendBtn').addEventListener('click', () => {
            isDefending = true;
            addBattleLog('é˜²å¾¡æ…‹å‹¢ï¼');
            enemyTurn();
        });

        document.getElementById('specialBtn').addEventListener('click', () => {
            const damage = 35;
            enemyHP = Math.max(0, enemyHP - damage);
            this.gameScore += damage;
            addBattleLog(`ç‰¹æ®Šæ”»æ’ƒï¼ ${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸`);
            document.getElementById('gameScore').textContent = this.gameScore;
            updateHealthBars();
            
            if (enemyHP > 0) enemyTurn();
        });
    }

    // Enhanced event binding for new features
    bindMinecraftEvents() {
        // Record mining button
        const recordMiningBtn = document.getElementById('recordMining');
        if (recordMiningBtn) {
            recordMiningBtn.addEventListener('click', () => this.recordCurrentMining());
        }

        // Inventory management
        const inventoryBtn = document.getElementById('inventoryBtn');
        if (inventoryBtn) {
            inventoryBtn.addEventListener('click', () => this.toggleInventoryDisplay());
        }

        // Crafting system
        const craftingBtn = document.getElementById('craftingBtn');
        if (craftingBtn) {
            craftingBtn.addEventListener('click', () => this.openCraftingInterface());
        }

        // Building projects
        const buildingBtn = document.getElementById('buildingBtn');
        if (buildingBtn) {
            buildingBtn.addEventListener('click', () => this.openBuildingInterface());
        }

        // Quick mining
        const quickMineBtn = document.getElementById('quickMineBtn');
        if (quickMineBtn) {
            quickMineBtn.addEventListener('click', () => this.performQuickMining());
        }

        // Intensity slider
        const intensitySlider = document.getElementById('intensitySlider');
        const intensityValue = document.getElementById('intensityValue');
        if (intensitySlider && intensityValue) {
            intensitySlider.addEventListener('input', (e) => {
                this.currentIntensity = parseInt(e.target.value);
                intensityValue.textContent = this.currentIntensity;
            });
        }

        // Progress stats toggle
        const toggleProgressStats = document.getElementById('toggleProgressStats');
        if (toggleProgressStats) {
            toggleProgressStats.addEventListener('click', () => this.toggleProgressDisplay());
        }
    }

    toggleInventoryDisplay() {
        const inventorySection = document.getElementById('inventorySection');
        if (inventorySection) {
            const isVisible = inventorySection.style.display !== 'none';
            inventorySection.style.display = isVisible ? 'none' : 'block';
            if (!isVisible) {
                this.renderInventory();
            }
        }
    }

    openCraftingInterface() {
        // Placeholder for crafting system
        this.showNotification('ğŸ”¨ ã‚¯ãƒ©ãƒ•ãƒˆã‚·ã‚¹ãƒ†ãƒ  - è¿‘æ—¥å…¬é–‹ï¼');
    }

    openBuildingInterface() {
        // Placeholder for building system
        this.showNotification('ğŸ—ï¸ å»ºç¯‰ã‚·ã‚¹ãƒ†ãƒ  - è¿‘æ—¥å…¬é–‹ï¼');
    }

    performQuickMining() {
        if (!this.currentBiome) {
            this.showNotification('å…ˆã«ãƒã‚¤ã‚ªãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„');
            return;
        }
        
        this.recordCurrentMining();
    }

    toggleProgressDisplay() {
        const progressSections = [
            'biomeLevelsDisplay',
            'minecraftAchievementsDisplay',
            'rareCollectionsDisplay'
        ];
        
        progressSections.forEach(sectionId => {
            const section = document.getElementById(sectionId);
            if (section) {
                const isVisible = section.style.display !== 'none';
                section.style.display = isVisible ? 'none' : 'block';
            }
        });
        
        const toggleBtn = document.getElementById('toggleProgressStats');
        if (toggleBtn) {
            const isVisible = document.getElementById('biomeLevelsDisplay').style.display !== 'none';
            toggleBtn.textContent = isVisible ? 'è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’éè¡¨ç¤º' : 'è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º';
        }
    }

    // Override the original bindEvents method to include new functionality
    bindEvents() {
        // Original biome events
        const biomeButtons = document.querySelectorAll('.biome-btn');
        biomeButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const biome = e.target.dataset.biome;
                if (this.biomeProgress[biome]?.unlocked) {
                    this.handleBiomeSelection(biome);
                } else {
                    this.showLockedBiomeMessage(biome);
                }
            });
        });

        // Theme events
        if (this.themeSelector) {
            this.themeSelector.addEventListener('change', (e) => {
                const selectedTheme = e.target.value;
                this.saveThemePreference(selectedTheme);
                this.applyTheme(selectedTheme);
            });
        }

        // Game events
        const gameButtons = [
            { id: 'startMiningGame', game: 'mining' },
            { id: 'startBuildingGame', game: 'building' },
            { id: 'startSurvivalGame', game: 'survival' },
            { id: 'startRedstoneGame', game: 'redstone' },
            { id: 'startPvPGame', game: 'pvp' }
        ];
        
        gameButtons.forEach(({ id, game }) => {
            const button = document.getElementById(id);
            if (button) {
                button.addEventListener('click', () => this.startMinecraftGame(game));
            }
        });
        
        const exitGameBtn = document.getElementById('exitGame');
        if (exitGameBtn) {
            exitGameBtn.addEventListener('click', () => this.exitMinecraftGame());
        }

        // Bind additional Minecraft-specific events
        this.bindMinecraftEvents();

        // Initialize displays
        this.renderPlayerStats();
        this.renderCreatureDisplay();
        this.updateBiomeButtons();
    }

    updateBiomeButtons() {
        const biomeButtons = document.querySelectorAll('.biome-btn');
        biomeButtons.forEach(button => {
            const biome = button.dataset.biome;
            if (this.biomeProgress[biome]?.unlocked) {
                button.classList.remove('locked');
                button.classList.add('unlocked');
            } else {
                button.classList.remove('unlocked');
                button.classList.add('locked');
            }
        });
    }
}

// Initialize the Minecraft Vibe Crafting app
const minecraftApp = new MinecraftVibeCrafting();
